!function(a){a.kui.instances.kcard={},a.kui.widgets.cards=function(c,d){return a.kui.list.actions({element:this,constructor:b,instances:a.kui.instances.kcard,data:c,aux:d})};var b=function(b,c){a.kui.list.params({list:this,div:b,params:c,rows:5})};b.prototype={name:"cards",setData:function(b){var c=this;a.each(b,function(a,b){c.data[a]=b})},nueva_grilla:function(){var b=this;a(b.div).addClass("kui-list form-horizontal"),b.contenido=a("<div>").attr("id",b.div.id+"_grilla").prependTo(b.div)},titulos:function(){},load:function(){var b=this;b.contenido?b.contenido.empty():b.nueva_grilla();var c=a.kui.data.source({source:b.source,sourceAjax:b.ajax,sourceData:b.data,key:"respuesta",message:b.mensaje,target:b.contenido});if(c){var d=c.datos,e={};b.totalDatos=parseInt(c.totalDatos),b.pagina=parseInt(c.pagina),b.totalPaginas=Math.ceil(b.totalDatos/b.data.rows),b.grilla=a("<div>").addClass("kCard").prependTo(b.contenido),a.each(d,function(a,c){e[c[b.id]]=c,b.load_entrada(c)}),b.grilla.find(".kscore").each(function(b,c){var d=124;a(c).css("width",d),a(c).css("height",d)}),b.grilla.find(".kacciones,.kscores").each(function(b,c){var d=a(c).parent().parent().height()-a(c).height(),e=a(c).next();e.hasClass("kscores")&&!e.is(":empty")?a(c).css("font-size","0.5em"):d/=2,d>0&&a(c).css("padding-top",d)}),a(b.div).data(a.kui.i18n.source,e),a(b.div).data(a.kui.i18n.totalData,b.totalDatos),a(b.div).data(a.kui.i18n.page,b.pagina),a(b.div).data(a.kui.i18n.totalPages,b.totalPaginas),a.kui.list.reloadPager(b)}"function"==typeof b.loadComplete&&b.loadComplete.call(this,c)},load_entrada:function(b){var c=this,d=void 0===b,e="kCard_"+c.div.id+"_"+(d?"nuevo_"+c.nuevos:b[c.id]),f=a("<div>").attr("id",e).attr("data-pk",b[c.id]).addClass("form-group well"),g=!!d;if(d||"function"!=typeof c.estado||(g=c.estado.call(this,b)),c.onclick){var h="function"==typeof c.onclick?c.onclick:function(){window.open(c.onclick,"_self")};f.addClass("kbtn").click(function(){h.call(this,b)})}else if(c.ondblclick&&("function"==typeof c.ondblclick||g&&"function"==typeof c.permisos.editar)){var i="function"==typeof c.ondblclick?c.ondblclick:function(){c.permisos.editar.call(this,b)};f.dblclick(function(){i.call(this,b)})}var j=a("<div>").addClass("col-sm-7").appendTo(f),k=a("<div>").addClass("text-right col-sm-5").appendTo(f),l=a("<div>").addClass("pull-right").addClass("kacciones").appendTo(k),m=a("<div>").addClass("kscores pull-right").appendTo(k);a.each(c.campos,function(c,d){var e;if("score"!==d.tipo){var f=6,g="<p>";"destacado"!==d.tipo&&"encabezado"!==d.tipo||(f=12),"encabezado"===d.tipo&&(g="<h2>"),e=a(g).addClass("col-sm-"+f).appendTo(j)}else e=a("<p>").appendTo(a("<div>").addClass("text-center pull-left kscore").appendTo(m));e.html(a.kui.data.format(b,d.nombre,d.formato)),d.titulo&&""!==d.titulo&&("score"!==d.tipo?a("<label>").addClass("text-muted").html(d.titulo+"&nbsp; &nbsp;").prependTo(e):(a("<br>").appendTo(e),a("<small>").html(d.titulo).appendTo(e))),"function"==typeof d.formato&&(b[d.nombre]=d.formato.call(this,b[d.nombre],b))});var n="fa-3x",o=function(b,c,d,f){var g=a("<a>").attr("id",e+"_"+b).addClass("text-muted kaccion").attr("title",c).attr("href",a.kui.dummyLink).html('<i class="fa '+n+" fa-"+d+'"></i>').hover(function(){a(this).removeClass("text-muted").addClass("text-"+f)},function(){a(this).addClass("text-muted").removeClass("text-"+f)});return g};if(g){if(c.permisos.editar){var p=o("editar",a.kui.i18n.editMsg,"pencil","primary");"function"==typeof c.permisos.editar&&p.click(function(a){a.stopPropagation(),c.permisos.editar.call(this,b)}),d||p.appendTo(l)}if(c.permisos.remover){var q=o("remover",a.kui.i18n.removeMsg,"times","danger");d||"function"!=typeof c.permisos.remover?q.click(function(b){b.stopPropagation(),a("#"+e).remove()}):q.click(function(a){a.stopPropagation(),c.permisos.remover.call(this,b)}),q.appendTo(l)}}else if("function"==typeof c.permisos.activar){f.addClass("has-error");var r=o("reactivar",a.kui.i18n.activateMsg,"check","success");r.click(function(a){a.stopPropagation(),c.permisos.activar.call(this,b)}).appendTo(l)}if(c.botones.length){var s=function(b){a(b).appendTo(l)};a.each(c.botones,function(c,d){if("function"!=typeof d.mostrar||d.mostrar.call(this,b)){var e=o(a.kui.randomId(),d.comentario,d.icono,"primary");e.attr("href",void 0!==d.enlace?d.enlace:a.kui.dummyLink),void 0!==d.onclick&&e.click(function(a){a.stopPropagation(),d.onclick.call(this,b)}),void 0!==d.atributos&&a.each(d.atributos,function(a,b){e.attr(a,b)}),s(e)}})}d?f.prependTo(c.grilla):f.appendTo(c.grilla)},agregar:function(a){var b=this;b.load_entrada(a)}}}(jQuery);