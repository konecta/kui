!function(a){a.kui.instances.kform={},a.fn.kForm=function(b){return a(this).kui("form",b)},a.kui.widgets.form=function(c){return a.kui.instances.kform[this.id]=new b(this,c)};var b=function(a,b){return void 0===b.campos||void 0===b.submit?void window.console.error('Los par√°metros "campos" y "submit" son obligatorios.'):(this.div=a,this.campos=b.campos,this.submit=b.submit,this.origen=b.origen,this.ajax_origen=void 0===b.ajaxOrigen?"GET":b.ajaxOrigen,this.ajax_submit=void 0===b.ajaxSubmit?"POST":b.ajaxSubmit,this.loadComplete=b.loadComplete,this.boton_submit=b.botonSubmit,this.readOnly=void 0===b.soloLectura?!1:b.soloLectura,this.data_origen=b.dataOrigen,this.after_submit=b.afterSubmit,void this.load())};b.prototype={nuevo_form:function(){var b=this;b.form=a("<form>").attr("id",b.div.id+"_form").addClass("kform form-horizontal").attr("action","#").prependTo(b.div)},load:function(){var b=this;b.form?b.form.empty():b.nuevo_form(),b.dato=a.kui.data.source({source:b.origen,sourceAjax:b.ajax_origen,sourceData:b.data_origen,key:"objeto",target:b.div}),b.load_campos()},load_campos:function(){var b=this,c=b.dato;b.fieldset=a("<fieldset>").appendTo(b.form),b.readOnly&&b.fieldset.attr("disabled",!0),a.each(b.campos,function(d,e){var f=a("<div>").addClass("form-group"+(e.oculto?" hidden":"")).appendTo(b.fieldset);void 0===e.titulo&&(e.titulo=e.nombre),a("<label>").addClass("klabel col-sm-4 control-label").html(e.titulo).appendTo(f);var g=a("<div>").addClass("col-sm-8").appendTo(f);a.kui.form.newElement(b.readOnly,g,c,e)}),a(b.div).data("dato",b.dato),b.funcion_submit(),"function"==typeof b.loadComplete&&b.loadComplete.call(this,b.dato)},funcion_submit:function(){var b=this;void 0===b.boton_submit?b.boton_submit=a("<button>").addClass("btn btn-primary").html(a.kui.i18n.saveMsg).appendTo(a("<div>").addClass("form-group text-right").appendTo(b.fieldset)):b.boton_submit=a(b.boton_submit),b.boton_submit.click(function(a){a.preventDefault(),b.form.submit()});var c="function"==typeof b.after_submit?function(a){b.after_submit.call(this,a)}:function(){},d="function"==typeof b.submit?function(a){c(b.submit.call(this,a,b.dato))}:function(d){a.ajax({type:b.ajax_submit,url:b.submit,data:d,success:function(d){d.mensaje&&a.kui.messages(b.mensaje,b.div,d.tipoMensaje,d.mensaje),c(d)},async:!1})};a.kui.form.validate.add({form:b.form,submit:function(){var a=b.contenido();"function"==typeof b.beforeSubmit&&b.beforeSubmit.call(this,a,b.dato),d(a)}})},contenido:function(){var b=this,c={};return a.each(b.form.serializeArray(),function(a,b){c[b.name]=b.value}),a.each(b.form.find("input[data-rol=input][type=checkbox]"),function(b,d){c[a(d).attr("name")]=a(d).is(":checked")}),c}}}(jQuery);