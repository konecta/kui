/*! kui - v0.0.7 - 2015-02-10
* https://github.com/konecta/kui
* Copyright (c) 2015 Nelson Paez; Licensed MIT */
/*! 
 *
 *   +++++++++++++++++++++ Core +++++++++++++++++++++ 
 *
 */
!function(a){a.fn.kui=function(){return this.each(function(b){a(this).html("kui"+b)})},a.kui=function(b){return b=a.extend({},a.kui.options,b),"kui"+b.punctuation},a.kui.options={punctuation:"."},a.expr[":"].kui=function(b){return-1!==a(b).text().indexOf("kui")},a.kui.mensaje=function(b,c,d,e){b&&b.remove(),b=a("<div>").attr("role","alert").addClass("alert").addClass(d?d:"alert-info").html(e).prependTo(c),a("<button>").attr("data-dismiss","alert").addClass("close").attr("type","button").html('<i class="fa fa-times"></i>').appendTo(b)},a.kui.formulario={nuevo_elemento:function(b,c,d,e){var f,g;if("function"==typeof e.formato)g=function(){e.formato.call(this,d[e.nombre],d)};else if("combo"===e.tipo){var h=function(a,b,c){return a[b]?a[b][c]:a[b+"."+c]?a[b+"."+c]:""};g=b?function(){return"function"==typeof e.opciones.formato?e.opciones.formato.call(this,d[e.nombre]?d[e.nombre]:d[e.nombre+"."+e.opciones.id]):h(d,e.nombre,e.opciones.formato)}:function(){return h(d,e.nombre,e.opciones.id)}}else g=function(){return d[e.nombre]};var i=function(b){return a("<"+b+">").addClass("form-control").attr("data-rol","input").attr("name",e.nombre).attr("placeholder",void 0===e.placeholder?e.titulo:e.placeholder).attr("title",void 0===e.mensaje?"El formato ingresado no es correcto para "+e.titulo:e.mensaje).val(g()).prop("required",e.requerido)},j=function(b){void 0!==e.icono&&(b=e.icono);var d=i("input");if(e.simple)d.appendTo(c);else{var f=a("<div>").addClass("input-group").appendTo(c);a("<span>").addClass("input-group-addon").html('<i class="fa fa-'+b+'"></i>').appendTo(f),d.appendTo(f)}return d},k=function(){var d=i(b?"input":"select");if(d.attr("name",e.nombre+"."+e.opciones.id),d.appendTo(c),!b){var f=[];"string"==typeof e.opciones.origen?a.ajax({type:e.opciones.ajax,url:e.opciones.origen,data:void 0===e.opciones.data?{_search:!1,filters:null,page:1,rows:10,sidx:e.opciones.id,sord:"asc",todos:!0}:e.opciones.data,success:function(a){a.error||(f=a.respuesta.datos)},async:!1}):f=e.opciones.origen;var h=!1;a.each(f,function(b,c){var f=a("<option>").attr("value",c[e.opciones.id]).html("function"==typeof e.opciones.formato?e.opciones.formato.call(this,c):c[e.opciones.formato]).appendTo(d);g().toString()===c[e.opciones.id].toString()&&(f.attr("selected",!0),h=!0)}),h||a("<option>").attr("value","").html("").attr("selected",!0).prependTo(d),d.combobox()}return d},l={fecha:{icono:"calendar",formato:"dd/MM/yyyy",constructor:{pickTime:!1}},hora:{icono:"clock-o",formato:"hh:mm:ss",constructor:{pickDate:!1}},"fecha-hora":{icono:"calendar-o",formato:"dd/MM/yyyy hh:mm:ss"}},m=function(c){e.simple=!1;var d=j(l[c].icono),f=d.parent();if(f.addClass("date"),d.attr("data-format",l[c].formato).attr("type","text").prependTo(f),"hora"!==c&&d.attr("data-rule-date",!0),!b){f.find(".input-group-addon").addClass("add-on").find("i").attr({"data-time-icon":"fa fa-clock-o","data-date-icon":"fa fa-calendar"});var g={language:"es",autoclose:!0};a.extend(g,l[c].constructor),f.datetimepicker(g);var h=a(".bootstrap-datetimepicker-widget.dropdown-menu");h.find("ul").addClass("list-unstyled"),h.find(".icon-chevron-up").addClass("fa fa-chevron-up"),h.find(".icon-chevron-down").addClass("fa fa-chevron-down"),h.find("th.prev").html(a("<i>").addClass("fa fa-chevron-left").css("font-size","0.5em")),h.find("th.next").html(a("<i>").addClass("fa fa-chevron-right").css("font-size","0.5em"))}return d};switch(e.tipo){case"booleano":f=i("input"),f.appendTo(c),f.prop("type","checkbox"),("true"===f.val()||"S"===f.val().toUpperCase())&&f.attr("checked","checked"),f.removeClass("form-control").css("margin-top","10px");break;case"numero":f=j("circle-thin"),f.attr("type","number");break;case"decimal":f=j("circle-thin"),f.attr("type","number"),f.attr("step","any");break;case"archivo":f=j("file"),f.attr("type","file");break;case"combo":f=k();break;case"fecha":f=m("fecha");break;case"hora":f=m("hora");break;case"fecha-hora":f=m("fecha-hora");break;default:f=j("align-right"),f.attr("type","text")}if(void 0!==e.atributos){a.each(e.atributos,function(a,b){f.attr(a,b)});var n=["disabled","readonly"];a.each(n,function(a,b){"false"===e.atributos[b]&&f.removeAttr(b),f.attr("data-"+b,e.atributos[b])})}},validar:{reglas:function(){a.validator.methods.date=function(a,b){var c=!1,d=/^\d{1,2}\/\d{1,2}\/\d{4}$/,e=/^\d{1,2}-\d{1,2}-\d{4}$/,f=function(b){var d=a.split(b),e=parseInt(d[0],10),f=parseInt(d[1],10),g=parseInt(d[2],10),h=new Date(g,f-1,e);c=h.getFullYear()===g&&h.getMonth()===f-1&&h.getDate()===e?!0:!1};return d.test(a)?f("/"):e.test(a)?f("-"):c=!1,this.optional(b)||c}},error:function(b,c,d){a.each(b.validElements(),function(b,c){var d=a(c);d.data("title","").removeClass("error").tooltip("destroy"),d.parent().removeClass("has-error")}),a.each(d,function(b,c){var d=a(c.element);d.tooltip("destroy").data("title",c.message).addClass("error").tooltip(),d.parent().addClass("has-error")})},fecha:function(b){a(b).find("input[data-rule-date=true]").each(function(b,c){var d,e=a(c).val(),f={dd:0,MM:1,yyyy:2};e.indexOf("/")>0?d=e.split("/"):(d=e.split("-"),f.yyyy=0,f.dd=2),a(c).val(3===d.length?d[f.yyyy]+"-"+d[f.MM]+"-"+d[f.dd]:"")})}}}}(jQuery);