/*! kui - v0.0.4 - 2015-02-03
* https://github.com/konecta/kui
* Copyright (c) 2015 Nelson Paez; Licensed MIT */
/*! 
 *
 *   +++++++++++++++++++++ kForm +++++++++++++++++++++ 
 *
 */
!function(a){a.kForms={instances:{}},a.fn.kForm=function(c){return this.each(function(){a.kForms.instances[this.id]=new b(this,c)})};var b=function(a,b){return void 0===b.campos||void 0===b.submit?void window.console.error('Los par√°metros "campos" y "submit" son obligatorios.'):(this.div=a,this.campos=b.campos,this.submit=b.submit,this.origen=b.origen,this.ajax_origen=void 0===b.ajaxOrigen?"GET":b.ajaxOrigen,this.ajax_submit=void 0===b.ajaxSubmit?"POST":b.ajaxSubmit,this.load_complete=b.loadComplete,this.boton_submit=b.botonSubmit,this.solo_lectura=void 0===b.soloLectura?!1:b.soloLectura,this.data_origen=b.dataOrigen,this.after_submit=b.afterSubmit,void this.cargar())};b.prototype={nuevo_form:function(){var b=this;b.form=a("<form>").attr("id",b.div.id+"_form").addClass("kform form-horizontal").attr("action","#").prependTo(b.div),b.seleccionable&&b.seleccionar(b.preseleccionados)},nuevo_mensaje:function(b,c){var d=this;d.mensaje&&d.mensaje.remove(),d.mensaje=a("<div>").attr("role","alert").addClass("alert").addClass(b?b:"alert-info").html(c).prependTo(d.div),a("<button>").attr("data-dismiss","alert").addClass("close").attr("type","button").html('<i class="fa fa-times"></i>').appendTo(d.mensaje)},cargar:function(){var b=this;b.form?b.form.empty():b.nuevo_form(),void 0===b.origen?b.dato={}:"string"==typeof b.origen?a.ajax({type:b.ajax_origen,url:b.origen,data:b.data_origen,success:function(a){a.error||(b.dato=a.objeto)},async:!1}):b.dato=b.origen,b.cargar_campos()},cargar_campos:function(){var b=this,c=b.dato;b.fieldset=a("<fieldset>").appendTo(b.form),b.solo_lectura&&b.fieldset.attr("disabled",!0),a.each(b.campos,function(d,e){var f=a("<div>").addClass("form-group").appendTo(b.fieldset);void 0===e.titulo&&(e.titulo=e.nombre),a("<label>").addClass("klabel col-md-3 control-label").html(e.titulo).appendTo(f);var g=a("<div>").addClass("col-md-6").appendTo(f);a("<div>").addClass("col-md-3").appendTo(f),a.kui.formulario.nuevo_elemento(b.solo_lectura,g,c,e)}),a(b.div).data("dato",b.dato),b.funcion_submit(),"function"==typeof b.load_complete&&b.load_complete.call(this,b.dato)},funcion_submit:function(){var b=this;b.boton_submit=void 0===b.boton_submit?a("<button>").addClass("btn btn-primary").html("Guardar").appendTo(a("<div>").addClass("form-group text-right").appendTo(b.fieldset)):a(b.boton_submit),b.boton_submit.click(function(a){a.preventDefault(),b.form.submit()}),a.kui.formulario.validar.reglas();var c="function"==typeof b.after_submit?function(a){b.after_submit.call(this,a)}:function(){},d="function"==typeof b.submit?function(){c(b.submit.call(this,b.contenido(),b.dato))}:function(){a.ajax({type:b.ajax_submit,url:b.submit,data:b.contenido(),success:function(a){a.mensaje&&b.nuevo_mensaje(a.tipoMensaje,a.mensaje),c(a)},async:!1})};a(b.form).validate({showErrors:function(b,c){a.kui.formulario.validar.error(this,b,c)},submitHandler:function(b){return a.kui.formulario.validar.fecha(b),d(),!1}})},contenido:function(){var b=this,c={};return a.each(b.form.serializeArray(),function(a,b){c[b.name]=b.value}),a.each(b.form.find("input[data-rol=input][type=checkbox]"),function(b,d){c[a(d).attr("name")]=a(d).is(":checked")}),c=a.extend({},b.dato,c)}}}(jQuery);