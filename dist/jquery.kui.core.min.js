/*! kui - v0.1.4 - 2015-05-26
* https://github.com/konecta/kui
* Copyright (c) 2015 Nelson Paez; Licensed MIT */
!function(a){a.fn.kui=function(b,c,d){return this.each(function(){a(this).attr("data-kui",!0),b&&(a(this).attr("data-widget",b),a.kui.widgets[b].call(this,c,d))})},a.kui=function(b){return b=a.extend({},a.kui.options,b),"kui"+b.punctuation},a.kui.options={punctuation:"."},a.expr[":"].kui=function(b){return-1!==a(b).text().indexOf("kui")},a.kui.widgets={},a.kui.instances={}}(jQuery),function(a){a.kui.formulario={nuevo_elemento:function(b,c,d,e){var f;b=b||e.soloLectura;var g=a.kui.data.format(d,e.nombre,e.formato,e.opciones,b),h=function(b){return a("<"+b+">").addClass("form-control").attr("data-rol","input").attr("name",e.nombre).attr("placeholder",void 0===e.placeholder?e.titulo:e.placeholder).attr("title",void 0===e.mensaje?"El formato ingresado no es correcto para "+e.titulo:e.mensaje).val(g).prop("required",e.requerido)},i=function(b){void 0!==e.icono&&(b=e.icono);var d=h("input");if(e.simple)d.appendTo(c);else{var f=a("<div>").addClass("input-group").appendTo(c);a("<span>").addClass("input-group-addon").html('<i class="fa fa-'+b+'"></i>').appendTo(f),d.appendTo(f)}return d},j=function(){var d=h(b?"input":"select");if(d.attr("name",e.nombre+"."+e.opciones.id),d.appendTo(c),!b){var f=[];"string"==typeof e.opciones.origen?a.ajax({type:e.opciones.ajax,url:e.opciones.origen,data:void 0===e.opciones.data?{_search:!1,filters:null,page:1,rows:10,sidx:e.opciones.id,sord:"asc",todos:!0}:e.opciones.data,success:function(a){a.error||(f=a.respuesta.datos)},async:!1}):f=e.opciones.origen;var i=!1;a.each(f,function(b,c){var f=a("<option>").attr("value",c[e.opciones.id]).html("function"==typeof e.opciones.formato?e.opciones.formato.call(this,c):c[e.opciones.formato]).appendTo(d);g.toString()===c[e.opciones.id].toString()&&(f.attr("selected",!0),i=!0)}),i||a("<option>").attr("value","").html("").attr("selected",!0).prependTo(d),d.combobox()}return d},k={fecha:{icono:"calendar",formato:"dd/MM/yyyy",rule:"date",constructor:{pickTime:!1}},hora:{icono:"clock-o",formato:"hh:mm:ss",rule:"hour",constructor:{pickDate:!1}},"fecha-hora":{icono:"calendar-o",rule:"datetime",formato:"dd/MM/yyyy hh:mm:ss"}},l=function(c){e.simple=!1;var d=i(k[c].icono),f=d.parent();if(f.addClass("date"),d.attr("data-format",k[c].formato).attr("type","text").attr("data-rule-"+k[c].rule,!0).prependTo(f),!b){f.find(".input-group-addon").addClass("add-on").find("i").attr({"data-time-icon":"fa fa-clock-o","data-date-icon":"fa fa-calendar"});var g={language:"es",autoclose:!0};a.extend(g,k[c].constructor),f.datetimepicker(g);var h=a(".bootstrap-datetimepicker-widget.dropdown-menu");h.find("ul").addClass("list-unstyled"),h.find(".icon-chevron-up").addClass("fa fa-chevron-up"),h.find(".icon-chevron-down").addClass("fa fa-chevron-down"),h.find("th.prev").html(a("<i>").addClass("fa fa-chevron-left").css("font-size","0.5em")),h.find("th.next").html(a("<i>").addClass("fa fa-chevron-right").css("font-size","0.5em"))}return d};switch(e.tipo){case"booleano":f=h("input"),f.appendTo(c),f.prop("type","checkbox"),f.prop("checked",g),f.removeClass("form-control"),c.addClass("checkbox");break;case"numero":f=i("circle-thin"),f.attr("type","number");break;case"decimal":f=i("circle-thin"),f.attr("type","number"),f.attr("step","any");break;case"archivo":f=i("file"),f.attr("type","file");break;case"combo":f=j();break;case"fecha":f=l("fecha");break;case"hora":f=l("hora");break;case"fecha-hora":f=l("fecha-hora");break;default:f=i("align-right"),f.attr("type","text")}if(void 0!==e.atributos){a.each(e.atributos,function(a,b){f.attr(a,b)});var m=["disabled","readonly"];a.each(m,function(a,b){"false"===e.atributos[b]&&f.removeAttr(b),f.attr("data-"+b,e.atributos[b])})}},validar:{reglas:function(){a.validator.methods.date=function(a,b){var c=!1,d=/^\d{1,2}\/\d{1,2}\/\d{4}$/,e=/^\d{1,2}-\d{1,2}-\d{4}$/,f=function(b){var d=a.split(b),e=parseInt(d[0],10),f=parseInt(d[1],10),g=parseInt(d[2],10),h=new Date(g,f-1,e);c=h.getFullYear()===g&&h.getMonth()===f-1&&h.getDate()===e?!0:!1};return d.test(a)?f("/"):e.test(a)?f("-"):c=!1,this.optional(b)||c}},error:function(b,c,d){a.each(b.validElements(),function(b,c){var d=a(c);d.data("title","").removeClass("error").tooltip("destroy"),d.parent().removeClass("has-error")}),a.each(d,function(b,c){var d=a(c.element);d.tooltip("destroy").data("title",c.message).addClass("error").tooltip(),d.parent().addClass("has-error")})},fecha:function(b){a(b).find("input[data-rule-date=true]").each(function(b,c){var d,e=a(c).val(),f={dd:0,MM:1,yyyy:2};e.indexOf("/")>0?d=e.split("/"):(d=e.split("-"),f.yyyy=0,f.dd=2),a(c).val(3===d.length?d[f.yyyy]+"-"+d[f.MM]+"-"+d[f.dd]:"")})}}}}(jQuery),function(a){a.kui.list={actions:function(b){if("string"==typeof b.data){var c=b.instances[b.element.id];if(void 0===c||null===c)return;switch(b.data){case"recargar":void 0!==b.aux&&c.set_data(b.aux),c.cargar();break;case"pagina":if(void 0===b.aux)return;var d=parseInt(b.aux);if(isNaN(d))switch(d=0,b.aux){case"primera":d=1;break;case"anterior":d=parseInt(c.pagina)-1;break;case"siguiente":d=parseInt(c.pagina)+1;break;case"ultima":d=c.totalPaginas;break;default:return}if(1>d||d>parseInt(c.totalPaginas))return;c.set_data({page:d}),c.cargar();break;case"buscar":if(void 0===b.aux)return;var e="AND";void 0!==b.aux.groupOp&&(e=b.aux.groupOp);var f=[];a.each(b.aux.reglas,function(a,c){f.push({field:c.field,data:void 0!==c.data?c.data:b.aux.data,op:void 0!==c.op?c.op:"cn"})}),c.set_data({_search:!0,filters:JSON.stringify({groupOp:e,rules:f})}),c.set_data({page:1}),c.cargar();break;case"seleccionar":c.seleccionar(b.aux);break;case"agregar":c.agregar(b.aux);break;default:return}}else{var g=new b.constructor(b.element,b.data);b.instances[b.element.id]=g}},params:function(b){if(void 0===b.params.url||void 0===b.params.id||void 0===b.params.campos)return void window.console.error("Los campos id, url y campos son obligatorios.");void 0===b.params.ajax&&(b.params.ajax="GET"),void 0===b.params.data&&(b.params.data={}),void 0===b.params.titulos&&(b.params.titulos=!0),void 0===b.params.permisos&&(b.params.permisos={}),void 0===b.params.retorno&&(b.params.retorno={}),void 0===b.params.botones&&(b.params.botones=[]),void 0===b.params.paginador&&(b.params.paginador=a("<div>").addClass("text-center").appendTo(b.div));var c={_search:!1,filters:null,page:1,rows:b.rows,sidx:b.params.id,sord:"asc",todos:!1};a.each(b.params.data,function(a,b){c[a]=b});var d={agregar:null,editar:null,guardar:null,activar:null,remover:null};if(a.each(b.params.permisos,function(a,b){d[a]=b}),b.params.seleccionable){var e={nombre:"kui_seleccionado",titulo:"",tipo:"booleano",ancho:1,editonly:!0,atributos:{"class":b.div.id+"_seleccionar_row"}};b.params.campos.unshift(e),b.params.seleccionados||(b.params.seleccionados=[]),b.list.checkall=a("<input>")}b.list.div=b.div,b.list.url=b.params.url,b.list.data=c,b.list.id=b.params.id,b.list.mostrar_titulos=b.params.titulos,b.list.etiquetas=[],b.list.campos=b.params.campos,b.list.ajax=b.params.ajax,b.list.permisos=d,b.list.botones=b.params.botones,b.list.estado=b.params.estado,b.list.load_complete=b.params.loadComplete,b.list.paginador=b.params.paginador,b.list.onclick=b.params.onclick,b.list.ondblclick=b.params.ondblclick,b.list.seleccionable=b.params.seleccionable,b.list.seleccionados={},b.list.preseleccionados=b.params.seleccionados,b.list.nuevos=0,b.list.enlace_dummy="javascript"+":".toLowerCase()+"void(0)",a.kui.list.cargar_estilos(),a.kui.list.cargar_paginador(b.list),b.list.titulos(),b.list.cargar(),a(b.div).on("reloadGrid",function(){a.kui.instances.kgrid[b.list.id].cargar()})},cargar_paginador:function(b){if(a(b.paginador).length){var c="kui_"+b.div.id+"_",d=a("<div>").attr("id",c+"paginador").addClass("kui-paginador btn-group").appendTo(b.paginador);a("<button>").attr("id",c+"primera_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-step-backward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,"pagina","primera")}),a("<button>").attr("id",c+"pagina_anterior").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-backward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,"pagina","anterior")});var e=a("#"+c+"pagina_anterior").outerHeight(),f=a("#"+c+"pagina_anterior").outerWidth(),g=a("<div>").addClass("btn btn-default kpagina").css("height",e>0?e:34).appendTo(d);a("<label>").html("PÃ¡gina ").appendTo(g),a("<input>").attr("id",c+"pagina").attr("type","text").addClass("pagina").css("width",f>0?f:39).appendTo(g).keyup(function(d){if(13===d.keyCode){d.preventDefault();var e=parseInt(a("#"+c+"pagina").val());if(isNaN(e)||0>e||e>b.totalPaginas)return void a("#"+c+"pagina").val(a("#"+c+"pagina").data("pagina"));e!==a("#"+c+"pagina").data("pagina")&&a("#"+b.div.id).kui(b.name,"pagina",e)}});var h=a("<label>").html(" de ").appendTo(g);a("<span>").attr("id",c+"totalPaginas").appendTo(h),a("<button>").attr("id",c+"siguiente_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-forward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,"pagina","siguiente")}),a("<button>").attr("id",c+"ultima_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-step-forward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,"pagina","ultima")})}},refrescar_paginador:function(b){a("#kui_"+b.div.id+"_pagina").val(b.pagina).data("pagina",b.pagina),a("#kui_"+b.div.id+"_totalPaginas").html(b.totalPaginas),a("#kui_"+b.div.id+"_primera_pagina").prop("disabled",1===b.pagina),a("#kui_"+b.div.id+"_pagina_anterior").prop("disabled",1===b.pagina),a("#kui_"+b.div.id+"_ultima_pagina").prop("disabled",b.pagina===b.totalPaginas),a("#kui_"+b.div.id+"_siguiente_pagina").prop("disabled",b.pagina===b.totalPaginas)},cargar_estilos:function(){if(!a("#kcard_estilos").length){var b={".kui-list .kbtn":["cursor: pointer"],".kui-list .kbtn:hover":["background: #ECECF0","border: 1px solid #cacaca"],".kui-list h2":["padding-bottom: 10px"],".kui-list .kscore":["width: 0","height: 0","border: 1px solid #999999","background: #ECECF0","font-size: 1.7em","margin-left: 10px","overflow: hidden","border-radius: 50%"],".kui-list .kscore p":["margin-top: 25%"],".kui-list .kscore small":["font-size: 0.5em"],".kui-list .klabel":["margin-top: 20px"],".kui-list .kacciones":["white-space: nowrap"],".kui-list .kaccion":["margin-left: 15px"],".kui-list .kpagina":["overflow: hidden","padding-top: 2px"],".kui-list .kpagina input":["margin: 0 5px","text-align: center"],".kui-list .writing td":["background: #777777"],".kui-list .writing td:not(.kacciones)":["vertical-align: middle","padding: 0 !important"],".kui-list .writing .form-control, .kui-list .writing .input-group-addon":["background: none","box-shadow: none","border-radius: 0","border: none","color: #FFFFFF"],".kui-list .writing .kacciones a":["color: #FFFFFF"]},c="";a.each(b,function(b,d){c+=b+"{",a.each(d,function(a,b){c+=b+";"}),c+="}"});var d=a("head").find("link,style").first(),e=a("<style>").attr("id","kcard_estilos").html(c);d.length?d.before(e):e.prependTo("head")}}}}(jQuery),function(a){a.kui.messages=function(b,c,d,e){b&&b.remove(),b=a("<div>").attr("role","alert").addClass("alert").addClass(d?d:"alert-info").html(e).prependTo(c),a("<button>").attr("data-dismiss","alert").addClass("close").attr("type","button").html('<i class="fa fa-times"></i>').appendTo(b)}}(jQuery),function(a){a.kui.random_id=function(){return"xxxx-xxxx-xxxx".replace(/[x]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)}).toUpperCase()},a.kui.data={format:function(a,b,c,d,e){if(d){var f=function(a,b,c){return a[b]?a[b][c]:a[b+"."+c]?a[b+"."+c]:""};return e?"function"==typeof d.formato?d.formato.call(this,a[b]?a[b]:a[b+"."+d.id]):f(a,b,d.formato):f(a,b,d.id)}return"function"==typeof c?c.call(this,a[b],a):a[b]}}}(jQuery);