/*! kui - v0.2.3 - 2015-07-02
* https://github.com/konecta/kui
* Copyright (c) 2015 Nelson Paez; Licensed MIT */
!function(a){a.fn.kui=function(b,c,d){return this.each(function(){a(this).attr("data-kui",!0),b&&(a(this).attr("data-widget",b),a.kui.widgets[b].call(this,c,d))})},a.kui=function(b){return b=a.extend({},a.kui.options,b),"kui"+b.punctuation},a.kui.options={punctuation:"."},a.expr[":"].kui=function(b){return-1!==a(b).text().indexOf("kui")},a.kui.widgets={},a.kui.instances={}}(jQuery),function(a){a.kui.form={newElement:function(b,c,d,e,f){b=b||e.soloLectura,f&&void 0!==e.atributos&&e.atributos["data-creable"]&&(b=!1);var g,h=a.kui.data.format(d,e.nombre,e.formato,e.opciones,b),i=function(b){return a("<"+b+">").addClass("form-control").attr("data-rol","input").attr("name",e.nombre).attr("placeholder",void 0===e.placeholder?e.titulo:e.placeholder).attr("title",void 0===e.mensaje?"El formato ingresado no es correcto para "+e.titulo:e.mensaje).val(h).prop("required",e.requerido)},j=function(b){void 0!==e.icono&&(b=e.icono);var d=i("input");if(e.simple)d.appendTo(c);else{var f=a("<div>").addClass("input-group").appendTo(c);a("<span>").addClass("input-group-addon").html('<i class="fa fa-'+b+'"></i>').appendTo(f),d.appendTo(f)}return d},k=function(){var f=!e.opciones.id||!e.opciones.formato,g=e.nombre;f||(g+="."+e.opciones.id);var j=i(b?"input":"select");if(j.attr("name",g),j.appendTo(c),!b){var k=[];"string"==typeof e.opciones.origen?a.ajax({type:e.opciones.ajax,url:e.opciones.origen,data:void 0===e.opciones.data?{_search:!1,filters:null,page:1,rows:10,sidx:e.opciones.id,sord:"asc",todos:!0}:e.opciones.data,success:function(a){a.error||(k=a.respuesta.datos)},async:!1}):k="function"==typeof e.opciones.origen?e.opciones.origen.call(this,d):e.opciones.origen;var l=!1;a.each(k,function(b,c){var d=a("<option>"),g="";f?(g=c.toString(),d.html(c).attr("value",c)):(g=c[e.opciones.id],d.attr("value",g).html("function"==typeof e.opciones.formato?e.opciones.formato.call(this,c):c[e.opciones.formato])),d.appendTo(j),h&&h.toString()===g&&(d.attr("selected",!0),l=!0)}),l||a("<option>").html("").attr("selected",!0).prependTo(j),j.combobox()}return j},l={fecha:{icono:"calendar",formato:a.kui.i18n.dateFormat,rule:"date",constructor:{pickTime:!1}},hora:{icono:"clock-o",formato:a.kui.i18n.hourFormat,rule:"hour",constructor:{pickDate:!1}},"fecha-hora":{icono:"calendar-o",rule:"datetime",formato:a.kui.i18n.datetimeFormat}},m=function(c){e.simple=!1;var d=j(l[c].icono),f=d.parent();if(f.addClass("date"),d.attr("data-format",l[c].formato).attr("type","text").attr("data-rule-"+l[c].rule,!0).prependTo(f),!b){f.find(".input-group-addon").addClass("add-on").find("i").attr({"data-time-icon":"fa fa-clock-o","data-date-icon":"fa fa-calendar"});var g={language:"es",autoclose:!0};a.extend(g,l[c].constructor),f.datetimepicker(g);var h=a(".bootstrap-datetimepicker-widget.dropdown-menu");h.find("ul").addClass("list-unstyled"),h.find(".icon-chevron-up").addClass("fa fa-chevron-up"),h.find(".icon-chevron-down").addClass("fa fa-chevron-down"),h.find("th.prev").html(a("<i>").addClass("fa fa-chevron-left").css("font-size","0.5em")),h.find("th.next").html(a("<i>").addClass("fa fa-chevron-right").css("font-size","0.5em"))}return d};switch(e.tipo){case"booleano":g=i("input"),g.appendTo(c),g.prop("type","checkbox"),g.prop("checked",h),g.removeClass("form-control"),c.addClass("checkbox");break;case"numero":g=j("circle-thin"),g.attr("type","number");break;case"decimal":g=j("circle-thin"),g.attr("type","number"),g.attr("step","any");break;case"archivo":g=j("file"),g.attr("type","file");break;case"combo":g=k();break;case"fecha":g=m("fecha");break;case"hora":g=m("hora");break;case"fecha-hora":g=m("fecha-hora");break;default:g=j("align-right"),g.attr("type","text")}void 0!==e.atributos&&a.each(e.atributos,function(a,b){g.attr(a,b)}),b&&g.attr("booleano"===e.tipo?"disabled":"readonly",!0)},validate:{hasRules:!1,rules:function(){a.kui.form.validate.hasRules||(a.validator.methods.date=function(b,c){var d=a(c).parent().data("datetimepicker"),e=d.getDate();return this.optional(c)||void 0!==e},a.kui.form.validate.hasRules=!0)},error:function(b,c,d){a.each(b.validElements(),function(b,c){var d=a(c);d.data("title","").removeClass("error").tooltip("destroy"),d.parent().removeClass("has-error")}),a.each(d,function(b,c){var d=a(c.element);d.tooltip("destroy").data("title",c.message).addClass("error").tooltip(),d.parent().addClass("has-error")})},add:function(b){a(b.form).validate({showErrors:function(b,c){a.kui.form.validate.error(this,b,c)},submitHandler:function(c){return a(c).find("input[data-rule-date=true]").each(function(b,c){var d=a(c).parent().data("datetimepicker"),e=d.getDate(),f="";if(e){var g=e.getMonth()+1;f=e.getFullYear()+"-"+(10>g?"0":"")+g+"-"+e.getDate()}a(c).val(f)}),b.submit.call(this,c),!1}})}}}}(jQuery),function(a){a.kui.i18n={reload:"recargar",page:"pagina",first:"primera",prev:"anterior",next:"siguiente",last:"ultima",search:"buscar",select:"seleccionar",add:"agregar",edit:"editar",save:"guardar",activate:"activar",remove:"remover",editMsg:"Editar",saveMsg:"Guardar",activateMsg:"Reactivar",removeMsg:"Remover",prevMsg:"Anterior",nextMsg:"Siguiente",id:"id",fields:"campos",ajax:"ajax",data:"data",titles:"titulos",actions:"permisos",sourceFormat:"retorno",buttons:"botones",pager:"paginador",selectable:"seleccionable",selected:"seleccionados",state:"estado",loadComplete:"loadComplete",onclick:"onclick",ondblclick:"ondblclick",reloadGrid:"reloadGrid",totalData:"totalDatos",totalPages:"totalPaginas",submit:"submit",submitAjax:"ajaxSubmit",submitButton:"botonSubmit",source:"origen",sourceAjax:"ajaxOrigen",sourceData:"dataOrigen",readOnly:"soloLectura",afterSubmit:"afterSubmit",steps:"pasos",indices:"indices",validate:"validacion",dateFormat:"dd/MM/yyyy",hourFormat:"hh:mm:ss",dateTimeFormat:"dd/MM/yyyy hh:mm:ss"}}(jQuery),function(a){a.kui.list={actions:function(b){if("string"==typeof b.data){var c=b.instances[b.element.id];if(void 0===c||null===c)return;switch(b.data){case a.kui.i18n.reload:void 0!==b.aux&&c.setData(b.aux),c.load();break;case a.kui.i18n.page:if(void 0===b.aux)return;var d=parseInt(b.aux);if(isNaN(d))switch(d=0,b.aux){case a.kui.i18n.first:d=1;break;case a.kui.i18n.prev:d=parseInt(c.pagina)-1;break;case a.kui.i18n.next:d=parseInt(c.pagina)+1;break;case a.kui.i18n.last:d=c.totalPaginas;break;default:return}if(1>d||d>parseInt(c.totalPaginas))return;c.setData({page:d}),c.load();break;case a.kui.i18n.search:if(void 0===b.aux)return;var e="AND";void 0!==b.aux.groupOp&&(e=b.aux.groupOp);var f=[];a.each(b.aux.reglas,function(a,c){f.push({field:c.field,data:void 0!==c.data?c.data:b.aux.data,op:void 0!==c.op?c.op:"cn"})}),c.setData({_search:!0,filters:JSON.stringify({groupOp:e,rules:f})}),c.setData({page:1}),c.load();break;case a.kui.i18n.select:c.seleccionar(b.aux);break;case a.kui.i18n.add:c.agregar(b.aux);break;default:return}}else{var g=new b.constructor(b.element,b.data);b.instances[b.element.id]=g}},params:function(b){if(void 0===b.params[a.kui.i18n.source]||void 0===b.params[a.kui.i18n.id]||void 0===b.params[a.kui.i18n.fields])return void window.console.error('The params "'+a.kui.i18n.source+'", "'+a.kui.i18n.id+'" and "'+a.kui.i18n.fields+'" are required.');var c={};c[a.kui.i18n.ajax]="GET",c[a.kui.i18n.titles]=!0,c[a.kui.i18n.serviceFormat]={},c[a.kui.i18n.buttons]=[],c[a.kui.i18n.data]={_search:!1,filters:null,page:1,rows:b.rows,sidx:b.params.id,sord:"asc",todos:!1};var d={};if(d[a.kui.i18n.add]=null,d[a.kui.i18n.edit]=null,d[a.kui.i18n.save]=null,d[a.kui.i18n.activate]=null,d[a.kui.i18n.remove]=null,c[a.kui.i18n.actions]=d,void 0===b.params[a.kui.i18n.pager]&&(b.params[a.kui.i18n.pager]=a("<div>").addClass("text-center").appendTo(b.div)),b.params[a.kui.i18n.selectable]){var e={nombre:"kui_seleccionado",titulo:"",tipo:"booleano",ancho:1,editonly:!0,atributos:{"class":b.div.id+"_seleccionar_row"}};b.params[a.kui.i18n.fields].unshift(e),b.params[a.kui.i18n.selected]||(b.params[[a.kui.i18n.selected]]=[]),b.list.checkall=a("<input>")}a.extend(!0,c,b.params),a.extend(b.list,{div:b.div,source:c[a.kui.i18n.source],data:c[a.kui.i18n.data],id:c[a.kui.i18n.id],showTitles:c[a.kui.i18n.titles],campos:c[a.kui.i18n.fields],ajax:c[a.kui.i18n.ajax],permisos:c[a.kui.i18n.actions],botones:c[a.kui.i18n.buttons],estado:c[a.kui.i18n.state],loadComplete:c[a.kui.i18n.loadComplete],pager:c[a.kui.i18n.pager],onclick:c[a.kui.i18n.onclick],ondblclick:c[a.kui.i18n.ondblclick],seleccionable:c[a.kui.i18n.selectable],seleccionados:{},preseleccionados:c[a.kui.i18n.selected],nuevos:0}),a.kui.list.load_estilos(),a.kui.list.loadPager(b.list),b.list.titulos(),b.list.load(),a(b.div).on("reloadGrid",function(){a("#"+b.list.div.id).kui(b.list.name,a.kui.i18n.reload)})},loadPager:function(b){if(a(b.pager).length){var c="kui_"+b.div.id+"_",d=a("<div>").attr("id",c+a.kui.i18n.pager).addClass("kui-pager btn-group").appendTo(b.pager);a("<button>").attr("id",c+"primera_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-step-backward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,a.kui.i18n.page,a.kui.i18n.first)}),a("<button>").attr("id",c+"pagina_anterior").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-backward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,a.kui.i18n.page,a.kui.i18n.prev)});var e=a("#"+c+"pagina_anterior").outerHeight(),f=a("#"+c+"pagina_anterior").outerWidth(),g=a("<div>").addClass("btn btn-default kpagina").css("height",e>0?e:34).appendTo(d);a("<label>").html("PÃ¡gina ").appendTo(g),a("<input>").attr("id",c+"pagina").attr("type","text").addClass("pagina").css("width",f>0?f:39).appendTo(g).keyup(function(d){if(13===d.keyCode){d.preventDefault();var e=parseInt(a("#"+c+"pagina").val());if(isNaN(e)||0>e||e>b.totalPaginas)return void a("#"+c+"pagina").val(a("#"+c+"pagina").data("pagina"));e!==a("#"+c+"pagina").data("pagina")&&a("#"+b.div.id).kui(b.name,"pagina",e)}});var h=a("<label>").html(" de ").appendTo(g);a("<span>").attr("id",c+"totalPaginas").appendTo(h),a("<button>").attr("id",c+"siguiente_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-forward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,a.kui.i18n.page,a.kui.i18n.next)}),a("<button>").attr("id",c+"ultima_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-step-forward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,a.kui.i18n.page,a.kui.i18n.last)})}},reloadPager:function(b){a("#kui_"+b.div.id+"_pagina").val(b.pagina).data("pagina",b.pagina),a("#kui_"+b.div.id+"_totalPaginas").html(b.totalPaginas),a("#kui_"+b.div.id+"_primera_pagina").prop("disabled",1===b.pagina),a("#kui_"+b.div.id+"_pagina_anterior").prop("disabled",1===b.pagina),a("#kui_"+b.div.id+"_ultima_pagina").prop("disabled",b.pagina===b.totalPaginas),a("#kui_"+b.div.id+"_siguiente_pagina").prop("disabled",b.pagina===b.totalPaginas)},load_estilos:function(){if(!a("#kcard_estilos").length){var b={".kui-list .kbtn":["cursor: pointer"],".kui-list .kbtn:hover":["background: #ECECF0","border: 1px solid #cacaca"],".kui-list h2":["padding-bottom: 10px"],".kui-list .kscore":["width: 0","height: 0","border: 1px solid #999999","background: #ECECF0","font-size: 1.7em","margin-left: 10px","overflow: hidden","border-radius: 50%"],".kui-list .kscore p":["margin-top: 25%"],".kui-list .kscore small":["font-size: 0.5em"],".kui-list .klabel":["margin-top: 20px"],".kui-list .kacciones":["white-space: nowrap"],".kui-list .kaccion":["margin-left: 15px"],".kui-list .kpagina":["overflow: hidden","padding-top: 2px"],".kui-list .kpagina input":["margin: 0 5px","text-align: center"],".kui-list .writing td":["background: #777777"],".kui-list .writing td:not(.kacciones)":["vertical-align: middle","padding: 0 !important"],".kui-list .writing .form-control, .kui-list .writing .input-group-addon":["background: none","box-shadow: none","border-radius: 0","border: none","color: #FFFFFF"],".kui-list .writing .kacciones a":["color: #FFFFFF"]},c="";a.each(b,function(b,d){c+=b+"{",a.each(d,function(a,b){c+=b+";"}),c+="}"});var d=a("head").find("link,style").first(),e=a("<style>").attr("id","kcard_estilos").html(c);d.length?d.before(e):e.prependTo("head")}}}}(jQuery),function(a){a.kui.messages=function(b,c,d,e){b&&b.remove(),b=a("<div>").attr("role","alert").addClass("alert").addClass(d?d:"alert-info").html(e).prependTo(c),a("<button>").attr("data-dismiss","alert").addClass("close").attr("type","button").html('<i class="fa fa-times"></i>').appendTo(b)}}(jQuery),function(a){a.kui.randomId=function(){return"xxxx-xxxx-xxxx".replace(/[x]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)}).toUpperCase()},a.kui.dummyLink="javascript"+":".toLowerCase()+"void(0)",a.kui.data={source:function(b,c,d){window.console.log("Params",b,c,d);var e={};return void 0===b?e={}:"string"==typeof b?a.ajax({type:c,url:b,data:d,success:function(a){a.error||(e=a)},async:!1}):e=b,window.console.log("Data",e),e},format:function(b,c,d,e,f){return e&&e.id&&e.formato?f?"function"==typeof e.formato?e.formato.call(this,b[c]?b[c]:b[c+"."+e.id]):a.kui.data.valueFromJson(b,c,e.formato):a.kui.data.valueFromJson(b,c,e.id):(window.console.log(b,c,b[c]),"function"==typeof d?d.call(this,b[c],b):b[c])},valueFromJson:function(a,b,c){return a[b]?a[b][c]:a[b+"."+c]?a[b+"."+c]:""},dateToIso:function(a){var b,c={dd:0,MM:1,yyyy:2};return a.indexOf("/")>0?b=a.split("/"):(b=a.split("-"),c.yyyy=0,c.dd=2),3===b.length?b[c.yyyy]+"-"+b[c.MM]+"-"+b[c.dd]:""}},a.kui.ajax=function(b){var c=a(b.div?b.div:"body");a("<div>").appendTo(c),window.console.log("Ajax start");var d=a.ajax(b);return window.console.log("Ajax stop"),d}}(jQuery);