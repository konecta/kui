/*! kui - v0.0.4 - 2015-02-03
* https://github.com/konecta/kui
* Copyright (c) 2015 Nelson Paez; Licensed MIT */
/*! 
 *
 *   +++++++++++++++++++++ Core +++++++++++++++++++++ 
 *
 */
!function(a){a.fn.kui=function(){return this.each(function(b){a(this).html("kui"+b)})},a.kui=function(b){return b=a.extend({},a.kui.options,b),"kui"+b.punctuation},a.kui.options={punctuation:"."},a.expr[":"].kui=function(b){return-1!==a(b).text().indexOf("kui")},a.kui.formulario={nuevo_elemento:function(b,c,d,e){var f,g=function(){return"function"==typeof e.formato?e.formato.call(this,d[e.nombre],d):d[e.nombre]},h=function(b){return a("<"+b+">").addClass("form-control").attr("data-rol","input").attr("name",e.nombre).attr("placeholder",void 0===e.placeholder?e.titulo:e.placeholder).attr("title",void 0===e.mensaje?"El formato ingresado no es correcto para "+e.titulo:e.mensaje).val(g()).prop("required",e.requerido)},i=function(b){void 0!==e.icono&&(b=e.icono);var d=h("input");if(e.simple)d.appendTo(c);else{var f=a("<div>").addClass("input-group").appendTo(c);a("<span>").addClass("input-group-addon").html('<i class="fa fa-'+b+'"></i>').appendTo(f),d.appendTo(f)}return d},j=function(){var d=h(b?"input":"select");if(d.appendTo(c),!b){var f=[];"string"==typeof e.opciones.origen?a.ajax({type:e.opciones.ajax,url:e.opciones.origen,data:void 0===e.opciones.data?{_search:!1,filters:null,page:1,rows:10,sidx:e.opciones.id,sord:"asc",todos:!0}:e.opciones.data,success:function(a){a.error||(f=a.respuesta.datos)},async:!1}):f=e.opciones.origen;var i=!1;a.each(f,function(b,c){var f=a("<option>").attr("value",c[e.opciones.id]).html("function"==typeof e.opciones.formato?e.opciones.formato.call(this,c):c[e.opciones.formato]).appendTo(d);g()===c[e.opciones.id]&&(f.attr("selected",!0),i=!0)}),i||a("<option>").attr("value","").html("").attr("selected",!0).prependTo(d),d.combobox()}return d},k={fecha:{icono:"calendar",formato:"dd/MM/yyyy",constructor:{pickTime:!1}},hora:{icono:"clock-o",formato:"hh:mm:ss",constructor:{pickDate:!1}},"fecha-hora":{icono:"clock-o",formato:"dd/MM/yyyy hh:mm:ss"}},l=function(c){var d=i(k[c].icono),e=d.parent();if(e.addClass("date"),d.attr("data-format",k[c].formato).attr("type","text").prependTo(e),"hora"!==c&&d.attr("data-rule-date",!0),!b){e.find(".input-group-addon").addClass("add-on");var f={language:"es",autoclose:!0};a.extend(f,k[c].constructor),e.datetimepicker(f)}return d};switch(e.tipo){case"booleano":f=h("input"),f.appendTo(c),f.prop("type","checkbox"),("true"===f.val()||"S"===f.val().toUpperCase())&&f.attr("checked","checked"),f.removeClass("form-control").css("margin-top","10px");break;case"numero":f=i("circle-thin"),f.attr("type","number");break;case"decimal":f=i("circle-thin"),f.attr("type","number"),f.attr("step","any");break;case"archivo":f=i("file"),f.attr("type","file");break;case"combo":f=j();break;case"fecha":f=l("fecha");break;case"hora":f=l("hora");break;case"fecha-hora":f=l("fecha-hora");break;default:return f=i("align-right"),void f.attr("type","text")}if(void 0!==e.atributos){a.each(e.atributos,function(a,b){f.attr(a,b)});var m=["disabled","readonly"];a.each(m,function(a,b){"false"===e.atributos[b]&&f.removeAttr(b),f.attr("data-"+b,e.atributos[b])})}},validar:{reglas:function(){a.validator.methods.date=function(a,b){var c=!1,d=/^\d{1,2}\/\d{1,2}\/\d{4}$/,e=/^\d{1,2}-\d{1,2}-\d{4}$/,f=function(b){var d=a.split(b),e=parseInt(d[0],10),f=parseInt(d[1],10),g=parseInt(d[2],10),h=new Date(g,f-1,e);c=h.getFullYear()===g&&h.getMonth()===f-1&&h.getDate()===e?!0:!1};return d.test(a)?f("/"):e.test(a)?f("-"):c=!1,this.optional(b)||c}},error:function(b,c,d){a.each(b.validElements(),function(b,c){var d=a(c);d.data("title","").removeClass("error").tooltip("destroy"),d.parent().removeClass("has-error")}),a.each(d,function(b,c){var d=a(c.element);d.tooltip("destroy").data("title",c.message).addClass("error").tooltip(),d.parent().addClass("has-error")})},fecha:function(b){a(b).find("input[data-rule-date=true]").each(function(b,c){var d,e=a(c).val(),f={dd:0,MM:1,yyyy:2};e.indexOf("/")>0?d=e.split("/"):(d=e.split("-"),f.yyyy=0,f.dd=2),a(c).val(3===d.length?d[f.yyyy]+"-"+d[f.MM]+"-"+d[f.dd]:"")})}}}}(jQuery),/*! 
 *
 *   +++++++++++++++++++++ kGrid +++++++++++++++++++++ 
 *
 */
function(a){a.kGrids={instances:{}},a.fn.kGrid=function(c,d){return this.each(function(){if("string"==typeof c){var e=a.kGrids.instances[this.id];if(void 0===e||null===e)return;switch(c){case"recargar":void 0!==d&&e.set_data(d),e.cargar();break;case"pagina":if(void 0===d)return;var f=parseInt(d);if(isNaN(f))switch(f=0,d){case"primera":f=1;break;case"anterior":f=parseInt(e.pagina)-1;break;case"siguiente":f=parseInt(e.pagina)+1;break;case"ultima":f=e.totalPaginas;break;default:return}if(1>f||f>parseInt(e.totalPaginas))return;e.set_data({page:f}),e.cargar();break;case"buscar":if(void 0===d)return;var g="AND";void 0!==d.groupOp&&(g=d.groupOp);var h=[];a.each(d.reglas,function(a,b){h.push({field:b.field,data:void 0!==b.data?b.data:d.data,op:void 0!==b.op?b.op:"cn"})}),e.set_data({_search:!0,filters:JSON.stringify({groupOp:g,rules:h})}),e.set_data({page:1}),e.cargar();break;case"seleccionar":e.seleccionar(d);break;case"agregar":e.agregar(d);break;default:return}}else{var i=new b(this,c);a.kGrids.instances[this.id]=i}})};var b=function(b,c){if(void 0===c.url||void 0===c.id||void 0===c.campos)return void window.console.error("Los campos id, url y campos son obligatorios.");void 0===c.ajax&&(c.ajax="GET"),void 0===c.data&&(c.data={}),void 0===c.titulos&&(c.titulos=!0),void 0===c.permisos&&(c.permisos={}),void 0===c.retorno&&(c.retorno={}),void 0===c.botones&&(c.botones=[]),void 0===c.paginador&&(c.paginador=a("<div>").addClass("text-center").appendTo(b));var d={_search:!1,filters:null,page:1,rows:10,sidx:c.id,sord:"asc",todos:!1};c.tarjetas&&(d.rows=5),a.each(c.data,function(a,b){d[a]=b});var e={agregar:null,editar:null,guardar:null,activar:null,remover:null};if(a.each(c.permisos,function(a,b){e[a]=b}),c.seleccionable){var f={nombre:"kGrid_seleccionado",titulo:"",tipo:"booleano",ancho:1,atributos:{readonly:"false",disabled:"false","class":b.id+"_seleccionar_row"}};c.campos.unshift(f),c.seleccionados||(c.seleccionados=[])}this.div=b,this.url=c.url,this.data=d,this.id=c.id,this.tarjetas=c.tarjetas,this.mostrar_titulos=c.titulos,this.etiquetas=[],this.campos=c.campos,this.ajax=c.ajax,this.permisos=e,this.botones=c.botones,this.estado=c.estado,this.load_complete=c.loadComplete,this.paginador=c.paginador,this.onclick=c.onclick,this.ondblclick=c.ondblclick,this.seleccionable=c.seleccionable,this.seleccionados={},this.preseleccionados=c.seleccionados,this.nuevos=0,this.enlace_dummy="javascript"+":".toLowerCase()+"void(0)",this.cargar_estilos(),this.cargar_paginador(),this.titulos(),this.cargar(),a(b).on("reloadGrid",function(){a.kGrids.instances[this.id].cargar()})};b.prototype={set_data:function(b){var c=this;a.each(b,function(a,b){c.data[a]=b})},nueva_grilla:function(){var b=this;a(b.div).addClass("kgrid form-horizontal"),b.contenido=a("<div>").attr("id",b.div.id+"_grilla").prependTo(b.div),b.seleccionable&&b.seleccionar(b.preseleccionados)},nuevo_mensaje:function(b,c){var d=this;d.mensaje&&d.mensaje.remove(),d.mensaje=a("<div>").attr("role","alert").addClass("alert").addClass(b?b:"alert-info").html(c).prependTo(d.contenido),a("<button>").attr("data-dismiss","alert").addClass("close").attr("type","button").html('<i class="fa fa-times"></i>').appendTo(d.mensaje)},titulos:function(){var b=this;if(!b.tarjetas){var c=a("<div>").addClass("form-group hidden-xs hidden-sm"),d=a("<div>").addClass("col-md-11").appendTo(c);b.nueva_grilla(),a.each(b.campos,function(c,e){var f=a("<h4>");f.append(void 0!==e.titulo?e.titulo:e.nombre),b.etiquetas.push(f.html()),a("<i>").addClass("fa fa-fw fa-arrow-down text-muted").prependTo(f),e.ancho||(e.ancho=parseInt(12/b.campos.length));var g=a("<div>").html(f).addClass("col-md-"+e.ancho).appendTo(d);if(b.seleccionable&&0===c){g.addClass("text-center");var h=a("<input>").attr("id",b.div.id+"_seleccionar_todo").attr("type","checkbox").change(function(){var c=a(this).is(":checked");a("."+b.div.id+"_seleccionar_row").each(function(b,d){a(d).prop("checked",c),a(d).trigger("change")})});f.html(h)}}),c.prependTo(b.div),b.mostrar_titulos||c.hide()}},cargar:function(){var b=this;b.contenido?b.contenido.empty():b.nueva_grilla(),a.ajax({type:b.ajax,url:b.url,data:b.data,success:function(c){if(c.error)c.mensaje&&b.nuevo_mensaje(c.tipoMensaje,c.mensaje);else{var d=c.respuesta.datos,e={};b.totalDatos=c.respuesta.totalDatos,b.pagina=c.respuesta.pagina,b.totalPaginas=Math.ceil(b.totalDatos/b.data.rows),b.grilla=a("<div>").addClass("kGrid").prependTo(b.contenido),a.each(d,function(a,c){e[c[b.id]]=c,b.cargar_entrada(c)}),a(b.grilla).find("."+b.div.id+"_seleccionar_row").each(function(c,d){b.seleccionados[a(d).data("pk")]&&a(d).attr("checked","checked"),a(d).change(function(){b.cambiar_seleccion(a(d).data("pk"),a(d).is(":checked"))})}),b.tarjetas&&(b.grilla.find(".kscore").each(function(b,c){var d=.8*parseInt(a(c).parent().parent().parent().height());a(c).css("width",d),a(c).css("height",d)}),b.grilla.find(".kacciones,.kscores").each(function(b,c){var d=a(c).parent().parent().height()-a(c).height(),e=a(c).next();e.hasClass("kscores")&&!e.is(":empty")?a(c).css("font-size","0.5em"):d/=2,d>0&&a(c).css("padding-top",d)})),a(b.div).data("datos",e),a(b.div).data("totalDatos",b.totalDatos),a(b.div).data("pagina",b.pagina),a(b.div).data("totalPaginas",b.totalPaginas),a("#kGrid_"+b.div.id+"_pagina").val(b.pagina).data("pagina",b.pagina),a("#kGrid_"+b.div.id+"_totalPaginas").html(b.totalPaginas),a("#kGrid_"+b.div.id+"_primera_pagina").attr("disabled",1===b.pagina),a("#kGrid_"+b.div.id+"_pagina_anterior").attr("disabled",1===b.pagina),a("#kGrid_"+b.div.id+"_ultima_pagina").attr("disabled",b.pagina===b.totalPaginas),a("#kGrid_"+b.div.id+"_siguiente_pagina").attr("disabled",b.pagina===b.totalPaginas)}"function"==typeof b.load_complete&&b.load_complete.call(this,c)},async:!1})},cargar_entrada:function(b){var c=this,d=void 0===b,e="kGrid_"+c.div.id+"_"+(d?"nuevo_"+c.nuevos:b[c.id]),f=d&&c.permisos.agregar?c.permisos.agregar:c.permisos.guardar;if(d){if(a("#"+e).is(":visible")){var g=a("#"+e).find("input[data-editando]").first();return void(g.length?g.focus():(c.nuevos++,c.cargar_entrada(b)))}if(c.tarjetas||!f)return void window.console.error('Para agregar entradas vacías la grilla no debe ser tipo tarjeta y debe configurar el permiso "agregar" o "guardar"');b={}}var h=a("<div>").attr("id",e).attr("data-pk",b[c.id]).addClass("form-group"+(c.tarjetas?" well":"")),i=d?!0:!1;if(d||"function"!=typeof c.estado||(i=c.estado.call(this,b)),c.onclick){var j="function"==typeof c.onclick?c.onclick:function(){window.open(c.onclick,"_self")};h.addClass("kbtn").click(function(){j.call(this,b)})}else if(c.ondblclick&&("function"==typeof c.ondblclick||i&&"function"==typeof c.permisos.editar)){var k="function"==typeof c.ondblclick?c.ondblclick:function(){c.permisos.editar.call(this,b)};h.dblclick(function(){k.call(this,b)})}var l=a(f?"<form>":"<div>").addClass("col-md-"+(c.tarjetas?"7":"11")).appendTo(h),m=a("<div>").addClass("text-right col-md-"+(c.tarjetas?"5":"1")).appendTo(h),n=a("<div>").addClass("pull-right").addClass("kacciones").appendTo(m),o=a("<div>").addClass("kscores pull-right").appendTo(m);a.each(c.campos,function(e,f){var g;if("score"!==f.tipo){var h=f.ancho,i="<div>";c.tarjetas&&(h=6,i="<p>",("destacado"===f.tipo||"encabezado"===f.tipo)&&(h=12),"encabezado"===f.tipo&&(i="<h2>")),g=a(i).addClass("col-md-"+h).appendTo(l)}else g=a("<p>").appendTo(a("<div>").addClass("text-center pull-left kscore").appendTo(o));if(c.tarjetas||a("<label>").addClass("klabel").addClass("visible-xs visible-sm").html(c.etiquetas[e]).appendTo(g),c.tarjetas)g.html("function"==typeof f.formato?f.formato.call(this,b[f.nombre],b):b[f.nombre]),f.titulo&&""!==f.titulo&&("score"!==f.tipo?a("<label>").addClass("text-muted").html(f.titulo+"&nbsp; &nbsp;").prependTo(g):(a("<br>").appendTo(g),a("<small>").html(f.titulo).appendTo(g)));else{void 0===f.simple&&(f.simple=!0),a.kui.formulario.nuevo_elemento(!d,g,b,f);var j=g.find("[data-rol=input]");j.hasClass(c.div.id+"_seleccionar_row")||j.attr("readonly",!0),"checkbox"===j.attr("type")&&(j.attr("data-pk",b[c.id]).dblclick(function(a){a.stopPropagation()}),j.attr("readonly")&&j.attr("disabled","disabled"),j.parent().addClass("text-center"))}"function"==typeof f.formato&&(b[f.nombre]=f.formato.call(this,b[f.nombre],b))});var p=c.tarjetas?"fa-3x":"fa-lg",q=function(b,d,f,g){var h=a("<a>").attr("id",e+"_"+b).addClass("text-muted kaccion").attr("title",d).attr("href",c.enlace_dummy).html('<i class="fa '+p+" fa-"+f+'"></i>').hover(function(){a(this).removeClass("text-muted").addClass("text-"+g)},function(){a(this).addClass("text-muted").removeClass("text-"+g)});return h},r=function(){a("#"+e+" form").find("input[readonly]").each(function(b,c){("true"!==a(c).attr("data-disabled")&&"true"!==a(c).attr("data-readonly")||d&&a(c).attr("data-creable"))&&a(c).removeAttr("readonly").removeAttr("disabled").attr("data-editando",!0).keyup(function(b){13===b.keyCode&&(b.preventDefault(),a("#"+e+" form").submit())})}),a("#"+e+"_editar").hide(),d||(a("#"+e+"_remover").hide(),a("#"+e+"_deshacer").fadeIn()),a("#"+e+"_guardar").fadeIn(),a("#"+e).find("input[data-editando]").first().focus()},s=function(){a("#"+e+" form").find("input[data-editando]").each(function(b,c){a(c).attr("readonly","false"!==a(c).attr("data-readonly")).removeAttr("data-editando").unbind("keyup"),"checkbox"===a(c).attr("type")&&a(c).attr("disabled","false"!==a(c).attr("data-disabled"))}),a("#"+e+"_guardar").hide(),a("#"+e+"_deshacer").hide(),a("#"+e+"_editar").fadeIn(),a("#"+e+"_remover").fadeIn()},t=function(){var b=a(c.div).data("datos")[a("#"+e).attr("data-pk")],d=a("#"+e+" form").find("input[data-editando]");s(),d.each(function(c,d){"checkbox"===a(d).attr("type")?a(d).prop("checked",b[a(d).attr("name")]):a(d).val(b[a(d).attr("name")])})};if(i){if(c.permisos.editar){var u=q("editar","Editar","pencil","primary");if("function"==typeof c.permisos.editar)u.click(function(a){a.stopPropagation(),c.permisos.editar.call(this,b)});else if(f){var v=q("guardar","Guardar","save","primary");v.hide();var w="function"==typeof f?function(a){f.call(this,a)}:function(b){a.ajax({type:"POST",url:f,data:b,success:function(){c.cargar()}})};a.kui.formulario.validar.reglas(),a(l).validate({showErrors:function(b,c){a.kui.formulario.validar.error(this,b,c)},submitHandler:function(c){a.kui.formulario.validar.fecha(c),s();var d={};return a.each(a("#"+e+" form").serializeArray(),function(a,b){d[b.name]=b.value}),a.each(a("#"+e+" form input[data-rol=input][type=checkbox]"),function(b,c){d[a(c).attr("name")]=a(c).is(":checked")}),d=a.extend({},b,d),w(d),!1}}),v.click(function(b){b.stopPropagation(),a("#"+e+" form").submit()}).appendTo(n);var x=q("deshacer","Deshacer cambios","undo","danger");x.hide().click(function(a){a.stopPropagation(),t()}).appendTo(n),u.click(function(a){a.stopPropagation(),r()})}d||u.appendTo(n)}if(c.permisos.remover){var y=q("remover","Remover","times","danger");y.click(d||"function"!=typeof c.permisos.remover?function(b){b.stopPropagation(),a("#"+e).remove()}:function(a){a.stopPropagation(),c.permisos.remover.call(this,b)}),y.appendTo(n)}}else if("function"==typeof c.permisos.activar){h.addClass("has-error");var z=q("reactivar","Reactivar","check","success");z.click(function(a){a.stopPropagation(),c.permisos.activar.call(this,b)}).appendTo(n)}a.each(c.botones,function(d,e){if("function"!=typeof e.mostrar||e.mostrar.call(this,b)){var f=a("<a>").attr("title",e.comentario).addClass("text-muted kaccion").attr("href",void 0!==e.enlace?e.enlace:c.enlace_dummy).html('<i class="fa '+p+" fa-"+e.icono+'"></i>').hover(function(){a(this).removeClass("text-muted")},function(){a(this).addClass("text-muted")});void 0!==e.onclick&&f.click(function(a){a.stopPropagation(),e.onclick.call(this,b)}),void 0!==e.atributos&&a.each(e.atributos,function(a,b){f.attr(a,b)}),f.appendTo(n)}}),d?(h.prependTo(c.grilla),r()):h.appendTo(c.grilla),c.tarjetas||h.after(a("<hr>").addClass("visible-xs visible-sm"))},cargar_paginador:function(){var b=this;if(a(b.paginador).length){var c="kGrid_"+b.div.id+"_",d=a("<div>").attr("id",c+"paginador").addClass("kGrid-paginador btn-group").appendTo(b.paginador);a("<button>").attr("id",c+"primera_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-step-backward")).appendTo(d).click(function(){a("#"+b.div.id).kGrid("pagina","primera")}),a("<button>").attr("id",c+"pagina_anterior").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-backward")).appendTo(d).click(function(){a("#"+b.div.id).kGrid("pagina","anterior")});var e=a("<div>").addClass("btn btn-default kpagina").css("height",a("#"+c+"pagina_anterior").outerHeight()).appendTo(d);a("<label>").html("Página ").appendTo(e),a("<input>").attr("id",c+"pagina").attr("type","text").addClass("pagina").css("width",a("#"+c+"pagina_anterior").outerWidth()).appendTo(e).keyup(function(d){if(13===d.keyCode){d.preventDefault();var e=parseInt(a("#"+c+"pagina").val());if(isNaN(e)||0>e||e>b.totalPaginas)return void a("#"+c+"pagina").val(a("#"+c+"pagina").data("pagina"));e!==a("#"+c+"pagina").data("pagina")&&a("#"+b.div.id).kGrid("pagina",e)}});var f=a("<label>").html(" de ").appendTo(e);a("<span>").attr("id",c+"totalPaginas").appendTo(f),a("<button>").attr("id",c+"siguiente_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-forward")).appendTo(d).click(function(){a("#"+b.div.id).kGrid("pagina","siguiente")}),a("<button>").attr("id",c+"ultima_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-step-forward")).appendTo(d).click(function(){a("#"+b.div.id).kGrid("pagina","ultima")})}},cargar_estilos:function(){if(!a("#kgrid_estilos").length){var b={".kgrid .kbtn":["cursor: pointer"],".kgrid .kbtn:hover":["background: #ECECF0","border: 1px solid #cacaca"],".kgrid h2":["padding-bottom: 10px"],".kgrid .kscore":["width: 0","height: 0","border: 1px solid #999999","background: #ECECF0","font-size: 1.7em","margin-left: 10px","overflow: hidden","border-radius: 50%"],".kgrid .kscore p":["margin-top: 25%"],".kgrid .kscore small":["font-size: 0.5em"],".kgrid .klabel":["margin-top: 20px"],".kgrid .kaccion":["margin-left: 15px"],".kgrid .kpagina":["overflow: hidden","padding-top: 2px"],".kgrid .kpagina input":["margin: 0 5px","text-align: center"]},c="";a.each(b,function(b,d){c+=b+"{",a.each(d,function(a,b){c+=b+";"}),c+="}"});var d=a("head").find("link,style").first(),e=a("<style>").attr("id","kgrid_estilos").html(c);d.length?d.before(e):e.prependTo("head")}},cambiar_seleccion:function(a,b){var c=this;c.seleccionados[a]=b,c.refrescar_seleccionados()},seleccionar:function(b){var c=this;c.seleccionados={},a.each(b,function(a,b){c.seleccionados[b]=!0}),a("."+c.div.id+"_seleccionar_row").each(function(b,d){a(d).removeAttr("checked"),c.seleccionados[a(d).data("pk")]&&a(d).prop("checked",!0)}),c.refrescar_seleccionados()},refrescar_seleccionados:function(){var b=this,c=[];a.each(b.seleccionados,function(a,b){b&&c.push(a)}),a(b.div).data("seleccionados",c)},agregar:function(a){var b=this;b.cargar_entrada(a)}}}(jQuery),/*! 
 *
 *   +++++++++++++++++++++ Core +++++++++++++++++++++ 
 *
 */
function(a){a.fn.kui=function(){return this.each(function(b){a(this).html("kui"+b)})},a.kui=function(b){return b=a.extend({},a.kui.options,b),"kui"+b.punctuation},a.kui.options={punctuation:"."},a.expr[":"].kui=function(b){return-1!==a(b).text().indexOf("kui")},a.kui.formulario={nuevo_elemento:function(b,c,d,e){var f,g=function(){return"function"==typeof e.formato?e.formato.call(this,d[e.nombre],d):d[e.nombre]},h=function(b){return a("<"+b+">").addClass("form-control").attr("data-rol","input").attr("name",e.nombre).attr("placeholder",void 0===e.placeholder?e.titulo:e.placeholder).attr("title",void 0===e.mensaje?"El formato ingresado no es correcto para "+e.titulo:e.mensaje).val(g()).prop("required",e.requerido)},i=function(b){void 0!==e.icono&&(b=e.icono);var d=h("input");if(e.simple)d.appendTo(c);else{var f=a("<div>").addClass("input-group").appendTo(c);a("<span>").addClass("input-group-addon").html('<i class="fa fa-'+b+'"></i>').appendTo(f),d.appendTo(f)}return d},j=function(){var d=h(b?"input":"select");if(d.appendTo(c),!b){var f=[];"string"==typeof e.opciones.origen?a.ajax({type:e.opciones.ajax,url:e.opciones.origen,data:void 0===e.opciones.data?{_search:!1,filters:null,page:1,rows:10,sidx:e.opciones.id,sord:"asc",todos:!0}:e.opciones.data,success:function(a){a.error||(f=a.respuesta.datos)},async:!1}):f=e.opciones.origen;var i=!1;a.each(f,function(b,c){var f=a("<option>").attr("value",c[e.opciones.id]).html("function"==typeof e.opciones.formato?e.opciones.formato.call(this,c):c[e.opciones.formato]).appendTo(d);g()===c[e.opciones.id]&&(f.attr("selected",!0),i=!0)}),i||a("<option>").attr("value","").html("").attr("selected",!0).prependTo(d),d.combobox()}return d},k={fecha:{icono:"calendar",formato:"dd/MM/yyyy",constructor:{pickTime:!1}},hora:{icono:"clock-o",formato:"hh:mm:ss",constructor:{pickDate:!1}},"fecha-hora":{icono:"clock-o",formato:"dd/MM/yyyy hh:mm:ss"}},l=function(c){var d=i(k[c].icono),e=d.parent();if(e.addClass("date"),d.attr("data-format",k[c].formato).attr("type","text").prependTo(e),"hora"!==c&&d.attr("data-rule-date",!0),!b){e.find(".input-group-addon").addClass("add-on");var f={language:"es",autoclose:!0};a.extend(f,k[c].constructor),e.datetimepicker(f)}return d};switch(e.tipo){case"booleano":f=h("input"),f.appendTo(c),f.prop("type","checkbox"),("true"===f.val()||"S"===f.val().toUpperCase())&&f.attr("checked","checked"),f.removeClass("form-control").css("margin-top","10px");break;case"numero":f=i("circle-thin"),f.attr("type","number");break;case"decimal":f=i("circle-thin"),f.attr("type","number"),f.attr("step","any");break;case"archivo":f=i("file"),f.attr("type","file");break;case"combo":f=j();break;case"fecha":f=l("fecha");break;case"hora":f=l("hora");break;case"fecha-hora":f=l("fecha-hora");break;default:return f=i("align-right"),void f.attr("type","text")}if(void 0!==e.atributos){a.each(e.atributos,function(a,b){f.attr(a,b)});var m=["disabled","readonly"];a.each(m,function(a,b){"false"===e.atributos[b]&&f.removeAttr(b),f.attr("data-"+b,e.atributos[b])})}},validar:{reglas:function(){a.validator.methods.date=function(a,b){var c=!1,d=/^\d{1,2}\/\d{1,2}\/\d{4}$/,e=/^\d{1,2}-\d{1,2}-\d{4}$/,f=function(b){var d=a.split(b),e=parseInt(d[0],10),f=parseInt(d[1],10),g=parseInt(d[2],10),h=new Date(g,f-1,e);c=h.getFullYear()===g&&h.getMonth()===f-1&&h.getDate()===e?!0:!1};return d.test(a)?f("/"):e.test(a)?f("-"):c=!1,this.optional(b)||c}},error:function(b,c,d){a.each(b.validElements(),function(b,c){var d=a(c);d.data("title","").removeClass("error").tooltip("destroy"),d.parent().removeClass("has-error")}),a.each(d,function(b,c){var d=a(c.element);d.tooltip("destroy").data("title",c.message).addClass("error").tooltip(),d.parent().addClass("has-error")})},fecha:function(b){a(b).find("input[data-rule-date=true]").each(function(b,c){var d,e=a(c).val(),f={dd:0,MM:1,yyyy:2};e.indexOf("/")>0?d=e.split("/"):(d=e.split("-"),f.yyyy=0,f.dd=2),a(c).val(3===d.length?d[f.yyyy]+"-"+d[f.MM]+"-"+d[f.dd]:"")})}}}}(jQuery),/*! 
 *
 *   +++++++++++++++++++++ kForm +++++++++++++++++++++ 
 *
 */
function(a){a.kForms={instances:{}},a.fn.kForm=function(c){return this.each(function(){a.kForms.instances[this.id]=new b(this,c)})};var b=function(a,b){return void 0===b.campos||void 0===b.submit?void window.console.error('Los parámetros "campos" y "submit" son obligatorios.'):(this.div=a,this.campos=b.campos,this.submit=b.submit,this.origen=b.origen,this.ajax_origen=void 0===b.ajaxOrigen?"GET":b.ajaxOrigen,this.ajax_submit=void 0===b.ajaxSubmit?"POST":b.ajaxSubmit,this.load_complete=b.loadComplete,this.boton_submit=b.botonSubmit,this.solo_lectura=void 0===b.soloLectura?!1:b.soloLectura,this.data_origen=b.dataOrigen,this.after_submit=b.afterSubmit,void this.cargar())};b.prototype={nuevo_form:function(){var b=this;b.form=a("<form>").attr("id",b.div.id+"_form").addClass("kform form-horizontal").attr("action","#").prependTo(b.div),b.seleccionable&&b.seleccionar(b.preseleccionados)},nuevo_mensaje:function(b,c){var d=this;d.mensaje&&d.mensaje.remove(),d.mensaje=a("<div>").attr("role","alert").addClass("alert").addClass(b?b:"alert-info").html(c).prependTo(d.div),a("<button>").attr("data-dismiss","alert").addClass("close").attr("type","button").html('<i class="fa fa-times"></i>').appendTo(d.mensaje)},cargar:function(){var b=this;b.form?b.form.empty():b.nuevo_form(),void 0===b.origen?b.dato={}:"string"==typeof b.origen?a.ajax({type:b.ajax_origen,url:b.origen,data:b.data_origen,success:function(a){a.error||(b.dato=a.objeto)},async:!1}):b.dato=b.origen,b.cargar_campos()},cargar_campos:function(){var b=this,c=b.dato;b.fieldset=a("<fieldset>").appendTo(b.form),b.solo_lectura&&b.fieldset.attr("disabled",!0),a.each(b.campos,function(d,e){var f=a("<div>").addClass("form-group").appendTo(b.fieldset);void 0===e.titulo&&(e.titulo=e.nombre),a("<label>").addClass("klabel col-md-3 control-label").html(e.titulo).appendTo(f);var g=a("<div>").addClass("col-md-6").appendTo(f);a("<div>").addClass("col-md-3").appendTo(f),a.kui.formulario.nuevo_elemento(b.solo_lectura,g,c,e)}),a(b.div).data("dato",b.dato),b.funcion_submit(),"function"==typeof b.load_complete&&b.load_complete.call(this,b.dato)},funcion_submit:function(){var b=this;b.boton_submit=void 0===b.boton_submit?a("<button>").addClass("btn btn-primary").html("Guardar").appendTo(a("<div>").addClass("form-group text-right").appendTo(b.fieldset)):a(b.boton_submit),b.boton_submit.click(function(a){a.preventDefault(),b.form.submit()}),a.kui.formulario.validar.reglas();var c="function"==typeof b.after_submit?function(a){b.after_submit.call(this,a)}:function(){},d="function"==typeof b.submit?function(){c(b.submit.call(this,b.contenido(),b.dato))}:function(){a.ajax({type:b.ajax_submit,url:b.submit,data:b.contenido(),success:function(a){a.mensaje&&b.nuevo_mensaje(a.tipoMensaje,a.mensaje),c(a)},async:!1})};a(b.form).validate({showErrors:function(b,c){a.kui.formulario.validar.error(this,b,c)},submitHandler:function(b){return a.kui.formulario.validar.fecha(b),d(),!1}})},contenido:function(){var b=this,c={};return a.each(b.form.serializeArray(),function(a,b){c[b.name]=b.value}),a.each(b.form.find("input[data-rol=input][type=checkbox]"),function(b,d){c[a(d).attr("name")]=a(d).is(":checked")}),c=a.extend({},b.dato,c)}}}(jQuery);